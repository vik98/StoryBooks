<% include ../partials/header %>

<h1>Welcome to the stories page</h1>
<div class="row">
<%if(stories){%>
  <%for (var i = 0; i < stories.length; i++) {%>
    <div class="col s12 m4">
      <div class="card">
      <%if(user){%>
        <!-- Used to put the pencil symbol only on authenticated posts as in only to the owner-->
        <%if(stories[i].user._id.equals(user._id)){%>
      <div class="card-image">
        <a href="/stories/edit/<%=stories[i]._id%>" class="btn-floating halfway-fab red"><i class="fa fa-pencil"></i></a>
      </div>
        <%}%>
      <%}%>
        <div class="card-content center-align">
          <h5><%=stories[i].title%></h5>
          <p class="story-text"><%=stories[i].body.replace(/<(?:.|\n)*?>/gm, "").substring(0, 150)%>...</p>
          <br>
          <div class="chip">
            <img src="<%=stories[i].user.image%>">
            <a href="/stories/user/<%=stories[i].user._id%>">
            <%=stories[i].user.firstName%> <%=stories[i].user.lastName%>
            </a>
          </div>
        </div>
        <div class="card-action center-align">
          <a class="btn grey" href="/stories/show/<%=stories[i]._id%>">
            Read More
          </a>
        </div>
      </div>
    </div>
  <%}%>
<%}else{%>
  <p>No public stories to display</p>
<%}%>
<% include ../partials/footer %>
